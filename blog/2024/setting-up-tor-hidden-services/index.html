<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Understanding Tor Hidden Services and Onion Routing | moscovium-mc's security blog </title> <meta name="author" content="moscovium-mc's security blog"> <meta name="description" content="How Tor hidden services provide anonymous hosting and the technical architecture behind onion addresses"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; media-src 'self' https:; frame-src 'self' https:; connect-src 'self' https:;"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%95%B8%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://moscovium-mc.github.io/blog/2024/setting-up-tor-hidden-services/"> <script src="/assets/js/theme.js?v=5fea5159b787642c1bbc1f334d60f883"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">moscovium-mc's</span> security blog </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/donate/">donate </a> </li> <li class="nav-item "> <a class="nav-link" href="/events/">events </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/books/">bookshelf</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="fa-solid fa-magnifying-glass"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-half-sun-moon" id="light-toggle-system"></i> <i class="fa-solid fa-moon" id="light-toggle-dark"></i> <i class="fa-solid fa-sun" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Understanding Tor Hidden Services and Onion Routing</h1> <p class="post-meta"> Created on March 29, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/tor"> <i class="fa-solid fa-hashtag fa-sm"></i> tor</a>   <a href="/blog/tag/onion-services"> <i class="fa-solid fa-hashtag fa-sm"></i> onion-services</a>   <a href="/blog/tag/network-architecture"> <i class="fa-solid fa-hashtag fa-sm"></i> network-architecture</a>   <a href="/blog/tag/privacy"> <i class="fa-solid fa-hashtag fa-sm"></i> privacy</a>   ·   <a href="/blog/category/security"> <i class="fa-solid fa-tag fa-sm"></i> security</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Tor hidden services, officially renamed “onion services” in 2015, represent a unique approach to anonymous communication on the internet. Unlike traditional Tor usage where clients browse the regular web anonymously, onion services allow servers themselves to operate anonymously without revealing their physical location or IP address. This bidirectional anonymity creates powerful privacy protections for both service operators and users.</p> <h2 id="the-architecture-of-anonymity">The Architecture of Anonymity</h2> <p>Understanding how onion services work requires grasping several key concepts that differentiate them from both regular web services and standard Tor client usage.</p> <p><strong>Symmetric Anonymity:</strong> In a typical Tor connection to a regular website, only the client is anonymous—the website knows its own IP address and location. With onion services, neither party knows the other’s IP address or physical location. The service operator doesn’t know who’s connecting, and users don’t know where the service is hosted.</p> <p><strong>Onion Addresses:</strong> Instead of traditional domain names or IP addresses, onion services are accessed via cryptographic identifiers ending in <code class="language-plaintext highlighter-rouge">.onion</code>. Version 3 onion addresses (the current standard) are 56 characters long and look like <code class="language-plaintext highlighter-rouge">thehiddenwiki3iw5nxcdmjcy7rgv4qu4mfrqgo3xuqrvlhh3byr3ad.onion</code>. These addresses are derived from the service’s public key, making them self-authenticating—you know you’re connecting to the right service because the address itself proves cryptographic identity.</p> <p><strong>The Rendezvous Protocol:</strong> Onion services don’t listen for incoming connections in the traditional sense. Instead, they use a complex rendezvous protocol involving several types of specialized Tor relays.</p> <h2 id="how-connection-establishment-works">How Connection Establishment Works</h2> <p>When an onion service starts up, it doesn’t simply announce itself to the world. The connection process involves multiple cryptographic steps designed to preserve anonymity for both parties.</p> <p><strong>Introduction Points:</strong> The onion service builds circuits to several randomly selected Tor relays, designating them as introduction points. These relays agree to relay introduction requests from clients to the service. The service publishes its introduction points to the distributed hash table (DHT) that Tor uses for onion service discovery, encrypting this information so only clients with the correct onion address can retrieve it.</p> <p><strong>Client Connection Process:</strong> When you want to connect to an onion service, your Tor client first retrieves the service’s descriptor from the DHT using the onion address. This descriptor contains the list of introduction points. Your client then builds a circuit to one of these introduction points and sends an introduction request.</p> <p><strong>Rendezvous Point Selection:</strong> Before sending the introduction request, your client selects a random Tor relay as a rendezvous point and establishes a circuit to it. The introduction request includes information about this rendezvous point.</p> <p><strong>Circuit Completion:</strong> The introduction point forwards your request to the onion service through its existing circuit. The service then builds a circuit to the rendezvous point. At this stage, both client and service have circuits to the rendezvous point, which connects them, allowing bidirectional communication without either party knowing the other’s location.</p> <p>This multi-step process ensures that no single relay knows both the client and service identities. The introduction points know the service but not which clients are connecting. The rendezvous point sees two anonymous circuits connecting but doesn’t know which belongs to the client and which to the service.</p> <h2 id="setting-up-an-onion-service">Setting Up an Onion Service</h2> <p>Creating an onion service is technically straightforward, though operational security considerations add complexity.</p> <p><strong>Installation and Configuration:</strong> Setting up an onion service requires a Tor installation and appropriate configuration. On most Linux systems, this means installing the <code class="language-plaintext highlighter-rouge">tor</code> package and editing <code class="language-plaintext highlighter-rouge">/etc/tor/torrc</code> or creating a configuration file in <code class="language-plaintext highlighter-rouge">/etc/tor/torrc.d/</code>.</p> <p>The basic configuration specifies which local service you want to expose and where Tor should store the service’s cryptographic keys:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HiddenServiceDir /var/lib/tor/my_service/
HiddenServicePort 80 127.0.0.1:8080
</code></pre></div></div> <p>This configuration tells Tor to create an onion service that forwards connections on port 80 to a local web server running on port 8080. The service directory contains the private keys that establish the service’s identity and corresponding onion address.</p> <p><strong>Key Management:</strong> The service’s private key is stored in the <code class="language-plaintext highlighter-rouge">HiddenServiceDir</code>. This key is critical—anyone with access to it can impersonate your service or decrypt past traffic if they recorded it. The key should be backed up securely and protected with appropriate filesystem permissions. Losing the key means losing the onion address permanently, as these addresses cannot be regenerated or recovered.</p> <p><strong>Multiple Services and Ports:</strong> A single Tor instance can host multiple onion services, each with its own directory and address. Services can also expose multiple ports, mapping them to different local services:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HiddenServiceDir /var/lib/tor/service_one/
HiddenServicePort 80 127.0.0.1:8080

HiddenServiceDir /var/lib/tor/service_two/
HiddenServicePort 80 127.0.0.1:9000
HiddenServicePort 22 127.0.0.1:22
</code></pre></div></div> <p><strong>Vanity Addresses:</strong> While onion addresses are cryptographically derived and appear random, some operators generate “vanity” addresses with recognizable prefixes. This requires computational work—trying billions of key pairs until finding one whose derived address starts with the desired characters. Tools like Eschalot and mkp224o automate this process, though finding longer vanity prefixes requires exponentially more computation.</p> <h2 id="legitimate-use-cases">Legitimate Use Cases</h2> <p>Onion services serve important legitimate purposes beyond the negative associations often made with the “dark web.”</p> <p><strong>Whistleblowing Platforms:</strong> Organizations like The New York Times, The Guardian, and The Washington Post operate SecureDrop instances as onion services. SecureDrop is an open-source whistleblower submission system designed by the Freedom of the Press Foundation. By operating as an onion service, these systems allow sources to submit documents without revealing their identity or location, protecting whistleblowers from retaliation.</p> <p><strong>Secure Communication:</strong> ProtonMail and other privacy-focused email providers offer onion service access. This protects users in countries where these services might be blocked and provides additional privacy by keeping email access entirely within the Tor network.</p> <p><strong>Censorship Circumvention:</strong> In countries with aggressive internet censorship, onion services provide a way to publish and access information that would otherwise be blocked. The New York Times operates an onion service specifically to allow readers in censored regions to access journalism freely.</p> <p><strong>Privacy-Preserving Services:</strong> Facebook famously operates an onion service (facebookcorewwwi.onion, or its current v3 address). While this might seem contradictory given Facebook’s data collection practices, it serves several purposes: allowing access in censored regions, protecting user connections from surveillance, and providing end-to-end encryption for Facebook access.</p> <p><strong>Research and Development:</strong> Security researchers, cryptographers, and privacy advocates use onion services for experiments, demonstrations, and testing new privacy-preserving protocols.</p> <h2 id="security-and-operational-considerations">Security and Operational Considerations</h2> <p>Operating an onion service securely requires careful attention to both technical configuration and operational security practices.</p> <p><strong>Application Security:</strong> The Tor network provides anonymity, not security. If the web application or service you’re hosting has vulnerabilities, those vulnerabilities still exist when accessed through Tor. In fact, many onion services have been compromised not through attacks on Tor itself, but through application-level vulnerabilities—SQL injection, cross-site scripting, authentication bypasses, or server misconfiguration.</p> <p><strong>Traffic Analysis Resistance:</strong> While onion services provide strong anonymity, they’re not immune to traffic analysis attacks. An adversary who can observe both a suspected server and onion service traffic might correlate patterns to identify the service location. This requires significant resources and is typically only a concern for services facing nation-state level adversaries. Mixing legitimate traffic, using decoy traffic, and careful operational security help mitigate these risks.</p> <p><strong>Timing Attacks:</strong> The rendezvous protocol involves multiple round trips, creating timing signatures. Researchers have demonstrated that sophisticated adversaries might be able to exploit these timing characteristics, though this remains primarily a theoretical concern for most operators.</p> <p><strong>Guard Discovery Attacks:</strong> Over time, an onion service tends to select a small set of guard nodes for its circuits. An adversary running many Tor relays might eventually become one of these guards, learning the service’s IP address. Tor has implemented various mitigations, including guard rotation policies and statistics obfuscation, but this remains an area of ongoing research.</p> <p><strong>Denial of Service:</strong> Onion services can be targeted with denial of service attacks. Because the introduction point mechanism limits how quickly services can handle new connections, attackers can flood introduction points with requests. Version 3 onion services include improved DoS protections, but this remains a challenge.</p> <p><strong>Physical Security:</strong> The server hosting an onion service must be physically secure. If an adversary can access the server, they can compromise it regardless of Tor’s anonymity protections. This includes considering cloud hosting risks—providers could be compelled to provide server access to law enforcement.</p> <p><strong>Metadata and Logging:</strong> Even with Tor, operational security mistakes can compromise anonymity. Servers should be configured to minimize logging, avoid leaking identifying information in error messages or HTTP headers, and generally treat all potential metadata as sensitive.</p> <h2 id="legal-and-ethical-responsibilities">Legal and Ethical Responsibilities</h2> <p>Operating an onion service comes with legal and ethical considerations that operators must understand.</p> <p><strong>Legal Compliance:</strong> Anonymity doesn’t mean legal immunity. Onion service operators are subject to the laws of the jurisdiction where they and their servers are located. Hosting illegal content or services remains illegal regardless of the anonymity Tor provides. Law enforcement agencies have successfully identified and prosecuted operators of illegal onion services through various means—application vulnerabilities, operational security mistakes, and traditional investigation.</p> <p><strong>Content Responsibility:</strong> Operators of platforms that host user-generated content must consider their responsibility for that content. While onion services can protect whistleblowers and free speech, they can also be misused. Responsible operators implement moderation policies, terms of service, and technical measures to prevent abuse while preserving legitimate privacy protections.</p> <p><strong>Ethical Operation:</strong> The decision to operate an onion service should be made thoughtfully, considering both the benefits it provides and potential harms. The privacy protections onion services offer enable important journalism, activism, and free expression, but also require careful stewardship.</p> <h2 id="the-evolution-of-onion-services">The Evolution of Onion Services</h2> <p>Onion services continue to evolve with improvements to both security and usability. Version 3 onion services, introduced in 2017 and made mandatory in 2021, brought significant improvements over version 2: stronger cryptography (Ed25519 instead of RSA), better denial-of-service protections, improved distributed hash table design, and defense against guard discovery attacks.</p> <p>Ongoing research and development focus on making onion services faster, more resistant to traffic analysis, easier to use, and more resilient to denial of service attacks. Features like OnionBalance allow load balancing across multiple backend servers while presenting a single onion address, enabling more scalable onion services.</p> <p>The Tor Project continues to work on improving the onion service protocol, addressing both theoretical attacks identified by researchers and practical challenges identified by operators of production services.</p> <h2 id="practical-recommendations">Practical Recommendations</h2> <p>For those considering operating an onion service, several practical recommendations emerge from the experiences of the community.</p> <p>Start with a clear understanding of your threat model. Who are you protecting against? What resources might they have? What would compromise look like? These answers guide technical and operational decisions.</p> <p>Implement defense in depth. Rely on application security, operating system hardening, network isolation, and Tor’s anonymity protections together, not individually. Each layer compensates for potential weaknesses in others.</p> <p>Stay informed about Tor developments, security advisories, and best practices. The Tor Project maintains documentation, mailing lists, and community resources specifically for onion service operators.</p> <p>Test thoroughly before deploying services handling sensitive information. Security audits, penetration testing, and code review all contribute to identifying issues before they can be exploited.</p> <p>Consider starting with a low-stakes service to gain experience with the technical and operational aspects before hosting anything critical.</p> <p>The power of onion services lies in their ability to provide strong anonymity protections for both service operators and users. When implemented thoughtfully with appropriate security measures, they enable important communications and services that would otherwise be impossible or dangerous in many parts of the world.</p> </div> </article> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <br> <script defer src="/assets/js/giscus-setup.js"></script> <noscript> Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 moscovium-mc's security blog. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?v=a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?v=6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?v=ccc841c459bfc0e64c1c2b5acd10df02"></script> </body> </html>